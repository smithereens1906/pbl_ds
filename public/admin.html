<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8">
  <title>Admin</title>
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet">
  <link rel="stylesheet" href="style.css">
</head>
<body class="bg-dark">
<div class="container py-5">
  <h2 class="gradient-text">Admin Panel</h2>

  <!-- login -->
  <div id="loginCard" class="glass-card p-4 mb-4" style="max-width:400px">
    <h4 class="text-white mb-3">Login</h4>
    <input id="user" class="form-control rounded-pill mb-2" placeholder="Username (Bijendra Rawat)">
    <input id="pass" type="password" class="form-control rounded-pill mb-3" placeholder="Password (admin123)">
    <button id="loginBtn" class="btn btn-glow rounded-pill w-100">Login</button>
  </div>

  <!-- actions -->
  <div id="actionCard" class="glass-card p-4 d-none">
    <button id="selectBtn" class="btn btn-glow rounded-pill mb-2">Select Best Candidate</button>
    <button id="restoreBtn" class="btn btn-outline-cyan rounded-pill mb-2">Restore Next Best</button>
    <div id="selectedInfo" class="alert glass-dark mt-3 d-none"></div>
    <a href="/" class="btn btn-sm btn-outline-light rounded-pill">Back to Home</a>
  </div>
</div>

<script>
let authed = false;
document.getElementById('loginBtn').addEventListener('click', async ()=>{
  const username = document.getElementById('user').value.trim();
  const password = document.getElementById('pass').value;
  const res = await fetch('/api/admin/login',{method:'POST',headers:{'Content-Type':'application/json'},body:JSON.stringify({username,password})});
  const json = await res.json();
  if(json.success){
    authed=true;
    document.getElementById('loginCard').classList.add('d-none');
    document.getElementById('actionCard').classList.remove('d-none');
    loadSelected();
  }else{
    alert('Invalid credentials');
  }
});

async function loadSelected(){
  const res = await fetch('/api/selected');
  const r = await res.json();
  const box = document.getElementById('selectedInfo');
  if(r.id){
    box.classList.remove('d-none');
    box.innerHTML=`Currently selected: <strong>${r.name}</strong> (score ${r.score})`;
  }else box.classList.add('d-none');
}
document.getElementById('selectBtn').addEventListener('click', async ()=>{
  await fetch('/api/select',{method:'POST'});
  alert('Best candidate selected'); loadSelected();
});
document.getElementById('restoreBtn').addEventListener('click', async ()=>{
  const res = await fetch('/api/restore',{method:'POST'});
  const json = await res.json();
  alert(json.error||`Restored: ${json.name} (score ${json.score})`);
  loadSelected();
});
</script>
</body>
</html>